<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CineBook - Movie Ticket Booking</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <div class="header-left">
          <h1>ðŸŽ¬ CineBook</h1>
          <p>Your Ultimate Movie Booking Experience</p>
        </div>
        <div class="header-right">
          <button class="btn logout-btn" onclick="logoutUser()">Logout</button>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" onclick="showTab('movies')">
          Browse Movies
        </button>
        <button class="tab" onclick="showTab('booking')">Book Tickets</button>
        <button class="tab" onclick="showTab('mybookings')">My Bookings</button>
      </div>

      <!-- Movies Tab -->
      <div id="movies" class="tab-content active">
        <h2>Now Showing</h2>
        <!-- Sorting Buttons -->
        <div style="margin-bottom: 15px">
          <button
            class="btn"
            style="width: auto; padding: 8px 16px; margin-right: 10px"
            onclick="sortMoviesBy('price')"
          >
            Sort by Price
          </button>
          <button
            class="btn"
            style="width: auto; padding: 8px 16px"
            onclick="sortMoviesBy('title')"
          >
            Sort by Title
          </button>
        </div>
        <div class="movies-grid" id="moviesGrid"></div>
      </div>

      <!-- Booking Tab -->
      <div id="booking" class="tab-content">
        <div class="booking-section">
          <h2>Book Your Tickets</h2>
          <div id="bookingMessage" class="message"></div>

          <div class="form-group">
            <label>Select Movie</label>
            <select id="movieSelect" onchange="updateShowtimes()">
              <option value="">Choose a movie</option>
            </select>
          </div>

          <div class="form-group">
            <label>Select Date</label>
            <input type="date" id="dateSelect" onchange="updateShowtimes()" />
          </div>

          <div class="form-group">
            <label>Select Showtime</label>
            <select id="showtimeSelect" onchange="loadSeats()">
              <option value="">Choose a showtime</option>
            </select>
          </div>

          <div
            class="seats-container"
            id="seatsContainer"
            style="display: none"
          >
            <h3>Select Your Seats</h3>
            <div class="screen">SCREEN</div>
            <div class="seats-grid" id="seatsGrid"></div>

            <div style="text-align: center; margin-top: 15px">
              <button
                class="btn"
                style="width: auto; padding: 8px 16px"
                onclick="loadSeats(true)"
              >
                Auto-Assign Best Seats
              </button>
            </div>

            <div class="seat-legend">
              <div class="legend-item">
                <div class="legend-color" style="background: #28a745"></div>
                <span>Available</span>
              </div>
              <div class="legend-item">
                <div class="legend-color" style="background: #667eea"></div>
                <span>Selected</span>
              </div>
              <div class="legend-item">
                <div class="legend-color" style="background: #dc3545"></div>
                <span>Booked</span>
              </div>
            </div>
          </div>

          <div class="summary" id="bookingSummary" style="display: none">
            <h3>Booking Summary</h3>
            <div class="summary-item">
              <span>Movie:</span>
              <span id="summaryMovie">-</span>
            </div>
            <div class="summary-item">
              <span>Date & Time:</span>
              <span id="summaryDateTime">-</span>
            </div>
            <div class="summary-item">
              <span>Seats:</span>
              <span id="summarySeats">-</span>
            </div>
            <div class="summary-item">
              <span>Tickets:</span>
              <span id="summaryTickets">0</span>
            </div>
            <div class="summary-item summary-total">
              <span>Total Amount:</span>
              <span id="summaryTotal">â‚¹0</span>
            </div>
          </div>

          <button class="btn" onclick="confirmBooking()">
            Confirm Booking
          </button>
        </div>
      </div>

      <!-- My Bookings Tab -->
      <div id="mybookings" class="tab-content">
        <h2>My Bookings</h2>
        <div class="booking-filter">
          <label for="filterStatus">Show:</label>
          <select id="filterStatus" onchange="loadUserBookings()">
            <option value="all">All</option>
            <option value="active">Active</option>
            <option value="cancelled">Cancelled</option>
          </select>
        </div>
        <div class="bookings-list" id="bookingsList"></div>
      </div>
    </div>
    <script>
      const currentUser = "{{ user }}";
    </script>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
  </body>
</html>
